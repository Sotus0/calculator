<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô ‚Äì ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
<meta name="color-scheme" content="light dark">
<style>
  /* ============ THEME & TOKENS ============ */
  :root{
    --bg: #0f1220; --card:#14182a; --soft:#0b0e1a; --line:#222944;
    --fg:#e9ecf7; --muted:#9aa3c0; --brand:#7b86ff; --brand-2:#49e1c8;
    --chip:#1a2040; --shadow:0 18px 50px rgba(0,0,0,.35);
    --radius: 16px;
    --gap: 12px;
    --pad: 16px;
    --font: clamp(15px, 1.15vw, 17px);
    --safe-b: env(safe-area-inset-bottom, 0px);
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f7fb; --card:#ffffff; --soft:#f0f2fb; --line:#e6e8f2;
      --fg:#0f1222; --muted:#5e6281; --brand:#6c7cff; --brand-2:#00c2a8;
      --chip:#eef0ff; --shadow:0 10px 40px rgba(15,18,34,.1);
    }
  }
  html{-webkit-text-size-adjust:100%}
  body{
    margin:0;
    background:linear-gradient(180deg,var(--bg), var(--soft));
    color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    font-size: var(--font);
  }
  .wrap{max-width: 1040px; margin: 28px auto; padding: 0 16px;}
  .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);}
  .pad{padding: var(--pad);}

  h1{margin:0 0 6px; font-size: clamp(1.2rem, 2.3vw, 1.8rem)}
  .sub{margin:0; color:var(--muted)}

  /* ============ RESPONSIVE GRID ============ */
  .grid{ display:grid; gap: var(--gap); }
  .grid-2{ grid-template-columns: 1fr; }
  @media (min-width: 740px){
    .grid-2{ grid-template-columns: 1.15fr .85fr; }
  }
  @container formc (min-width: 580px){
    form .cols{ grid-template-columns: repeat(3, minmax(0,1fr)); }
  }

  /* ============ FORM ============ */
  .form-card{ container-type: inline-size; container-name: formc; }
  form{ display:grid; gap: var(--gap); margin-top: 10px;}
  form .cols{ display:grid; gap: var(--gap); grid-template-columns: 1fr; }
  label{ display:block; font-size:.92rem; margin:6px 0; color:var(--muted) }
  .row{display:flex; flex-direction:column;}
  .err{ color:#ff6b6b; font-size:.85rem; min-height:1.2em; margin-top:4px; }
  input,select,button{
    width:100%; border:1px solid var(--line); background:transparent; color:var(--fg);
    border-radius: 12px; padding: 12px 14px; font-size: 1rem; min-height: 44px;
  }
  input::placeholder{ color: color-mix(in srgb, var(--muted) 70%, transparent); }
  input:focus,select:focus,button:focus{ outline:none; border-color:var(--brand); box-shadow:0 0 0 3px color-mix(in srgb, var(--brand) 25%, transparent); }
  .actions{ display:flex; gap:10px; flex-wrap: wrap; padding-bottom: max(0px, var(--safe-b)); }
  .btn{ cursor:pointer; border:none; font-weight:800; letter-spacing:.2px }
  .btn-primary{ background:linear-gradient(90deg,var(--brand), var(--brand-2)); color:#fff }
  .btn-ghost{ background:transparent }
  .btn-ghost:hover{ background: color-mix(in srgb, var(--chip) 60%, transparent) }

  @media (max-width: 768px){
    .sticky{
      position: sticky; bottom: 0; background: linear-gradient(180deg,transparent, var(--card) 35%);
      padding-top: 6px;
    }
  }

  /* ============ RESULT ============ */
  #result{ display:none }
  .hero{
    display:grid; align-items:center; gap:10px; grid-template-columns: auto 1fr;
    padding: 12px; border-radius: 14px; border:1px solid var(--line);
    background: linear-gradient(90deg, color-mix(in srgb, var(--brand) 18%, transparent), transparent 70%);
  }
  .badge{ background:var(--chip); padding:6px 10px; border-radius:999px; font-size:.9rem; display:inline-flex; align-items:center; gap:8px; }
  .big{ font-weight:900; font-size: clamp(1.8rem, 5vw, 2.4rem); letter-spacing:.3px }
  .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top: 12px; }
  .chip{ background:var(--chip); border:1px solid var(--line); padding:6px 10px; border-radius:999px; font-size:.9rem }

  .kpis{ display:grid; gap:var(--gap); grid-template-columns: 1fr; }
  @media (min-width: 620px){ .kpis{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
  .kpi{ text-align:center; padding: 12px; border-radius: 12px; border:1px solid var(--line);
        background: linear-gradient(180deg, transparent, color-mix(in srgb, var(--chip) 55%, transparent)); }
  .kpi .lab{ color:var(--muted); font-size:.9rem }
  .kpi .val{ font-weight:900; font-size: clamp(1.1rem, 2vw, 1.35rem); margin-top:6px }

  .bar{ margin-top:10px; height:10px; border-radius:999px; border:1px solid var(--line);
        background:color-mix(in srgb, var(--chip) 55%, transparent); overflow:hidden; }
  .bar>i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--brand), var(--brand-2)); transition:width .35s ease }
  .bar-legend{ display:flex; justify-content:space-between; font-size:.85rem; color:var(--muted); margin-top:6px }

  .menu{ display:grid; gap: var(--gap); grid-template-columns: 1fr; }
  @media (min-width: 700px){ .menu{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
  .tile{ display:flex; gap:12px; align-items:center; border:1px solid var(--line);
         background:var(--card); border-radius:12px; padding:12px; }
  .ico{ width:38px; height:38px; border-radius:10px; display:grid; place-items:center;
        background: color-mix(in srgb, var(--brand) 25%, transparent); flex: 0 0 38px; }
  .muted{ color:var(--muted); font-size:.9rem }
  .mt16{ margin-top:16px }

  /* reduce motion */
  @media (prefers-reduced-motion: reduce){
    .bar>i{ transition:none !important }
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- FORM -->
    <div class="card pad form-card">
      <h1 id="calcTitle">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</h1>
      <p class="sub" id="calcDesc"></p>

      <form id="form" novalidate aria-describedby="calcDesc">
        <div class="cols" role="group" aria-labelledby="calcTitle">
          <div class="row">
            <label for="weight">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß (‡∏Å‡∏Å.)</label>
            <input id="weight" type="number" min="20" max="300" step="0.1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 62.5" required
                   inputmode="decimal" enterkeyhint="done" autocomplete="off">
            <div class="err" id="errWeight"></div>
          </div>
          <div class="row">
            <label for="age">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
            <input id="age" type="number" min="10" max="100" step="1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 25" required
                   inputmode="numeric" enterkeyhint="done" autocomplete="off">
            <div class="err" id="errAge"></div>
          </div>
          <div class="row">
            <label for="gender">‡πÄ‡∏û‡∏®</label>
            <select id="gender">
              <option value="male">‡∏ä‡∏≤‡∏¢</option>
              <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
            </select>
          </div>
          <div class="row">
            <label for="activity">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
            <select id="activity">
              <option value="sedentary">‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà</option>
              <option value="light">‡πÄ‡∏ö‡∏≤ (‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á 1‚Äì2 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
              <option value="moderate" selected>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3‚Äì4 ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
              <option value="high">‡∏™‡∏π‡∏á (5+ ‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)</option>
            </select>
          </div>
          <div class="row">
            <label for="goal">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
            <select id="goal">
              <option value="mild">‡∏Ñ‡∏á‡∏ï‡∏±‡∏ß/‡∏•‡∏î‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡πÄ‡∏ö‡∏≤ ‡πÜ</option>
              <option value="moderate" selected>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
              <option value="aggressive">‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏±‡∏á (‡∏Ñ‡∏±‡∏ó/‡∏ö‡∏±‡∏•‡∏Ñ‡πå‡∏´‡∏ô‡∏±‡∏Å)</option>
            </select>
          </div>
          <div class="row">
            <label for="meals">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</label>
            <input id="meals" type="number" min="2" max="6" step="1" value="3" inputmode="numeric" enterkeyhint="go" required>
            <div class="err" id="errMeals"></div>
          </div>
        </div>

        <div class="actions sticky">
          <button type="submit" class="btn btn-primary" id="submitBtn" aria-describedby="calcDesc">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
          <button type="button" id="clear" class="btn btn-ghost">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
      </form>
    </div>

    <!-- RESULT -->
    <div id="result" class="grid grid-2 mt16" aria-live="polite">
      <!-- Summary -->
      <div class="card pad">
        <div class="hero">
          <span class="badge" aria-hidden="true">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M5 6h14M5 18h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
          </span>
          <div class="big" id="bigTotal">‚Äî ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô</div>
        </div>

        <div class="chips" role="list">
          <div class="chip" id="rangeChip" role="listitem">‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‚Äî ‡∏ñ‡∏∂‡∏á ‚Äî ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô</div>
          <div class="chip" id="kgChip" role="listitem">‚âà ‚Äî ‡∏Å‡∏£‡∏±‡∏°/‡∏Å‡∏Å.</div>
          <div class="chip" id="mealsChip" role="listitem">‚âà ‚Äî ‡∏Å‡∏£‡∏±‡∏°/‡∏°‡∏∑‡πâ‡∏≠ √ó <span id="mealsSpan">‚Äî</span> ‡∏°‡∏∑‡πâ‡∏≠</div>
        </div>

        <div class="bar" aria-hidden="true"><i id="barFill"></i></div>
        <div class="bar-legend" aria-hidden="true"><span id="barLeft">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (RDA)</span><span id="barRight">‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥</span></div>

        <div class="kpis mt16">
          <div class="kpi"><div class="lab">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div><div class="val" id="dailyVal">‚Äî ‡∏Å‡∏£‡∏±‡∏°</div></div>
          <div class="kpi"><div class="lab">‡∏ï‡πà‡∏≠‡∏°‡∏∑‡πâ‡∏≠</div><div class="val" id="perMealVal">‚Äî ‡∏Å‡∏£‡∏±‡∏°</div></div>
          <div class="kpi"><div class="lab">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ (RDA)</div><div class="val" id="rdaVal">‚Äî ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô</div></div>
        </div>
      </div>

      <!-- Example menu + Fruits -->
      <div class="card pad">
        <span class="badge" style="margin-bottom:10px">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤
        </span>
        <div class="menu" id="foodGrid"></div>

        <h3 class="muted mt16" style="margin:0">‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡∏ô‡∏¥‡∏ß‡πÄ‡∏ó‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡πå)</h3>
        <div class="menu mt16" id="fruitGrid"></div>

        <p class="muted mt16">
          *‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ‡∏≠‡∏Å‡πÑ‡∏Å‡πà 31g/100g, ‡πÑ‡∏Ç‡πà 6g/‡∏ü‡∏≠‡∏á, ‡∏ô‡∏° 8g/‡πÅ‡∏Å‡πâ‡∏ß (250ml), ‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï‡∏Å‡∏£‡∏µ‡∏Å 17g/‡∏ñ‡πâ‡∏ß‡∏¢ (170g),
          ‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ‡πÅ‡∏Ç‡πá‡∏á ~12g/100g, ‡∏ñ‡∏±‡πà‡∏ß‡∏î‡∏≥‡∏ï‡πâ‡∏° ~8g/100g, ‡πÄ‡∏ß‡∏¢‡πå 24g/‡∏™‡∏Å‡∏π‡πä‡∏õ |
          ‡∏Å‡∏•‡πâ‡∏ß‡∏¢ (‡∏Å‡∏•‡∏≤‡∏á) ~1.3g, ‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà 1 ‡∏ñ‡πâ‡∏ß‡∏¢ ~1.0g, ‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà 1 ‡∏ñ‡πâ‡∏ß‡∏¢ ~1.0g,
          ‡∏≠‡∏á‡∏∏‡πà‡∏ô 1 ‡∏ñ‡πâ‡∏ß‡∏¢ ~1.0g, ‡∏™‡πâ‡∏° (‡∏Å‡∏•‡∏≤‡∏á) ~1.2g, ‡∏≠‡∏∞‡πÇ‡∏ß‡∏Ñ‡∏≤‡πÇ‡∏î (‡∏Å‡∏•‡∏≤‡∏á) ~3.0g
        </p>
      </div>
    </div>

    <div class="card pad mt16">
      <div class="muted">‡∏ó‡∏¥‡∏õ: ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏ï‡πà‡∏≠‡∏°‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏î‡∏µ ~ <b>20‚Äì40 ‡∏Å‡∏£‡∏±‡∏°</b> (‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ) ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß/‡πÑ‡∏ï ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</div>
    </div>
  </div>

<script>
  /* ===== Device-aware UI tuning ===== */
  (function(){
    const body = document.body;
    const rootStyle = document.documentElement.style;

    function isTouch(){ return matchMedia('(pointer: coarse)').matches; }
    function deviceKind(){
      const w = window.innerWidth;
      if (isTouch() && w <= 820) return 'mobile';
      if (isTouch() && w <= 1180) return 'tablet';
      return w >= 1024 ? 'desktop' : 'mobile';
    }
    function tuneDensity(){
      const kind = deviceKind();
      body.dataset.device = kind;
      if (kind === 'mobile'){
        rootStyle.setProperty('--gap', '10px');
        rootStyle.setProperty('--pad', '14px');
        rootStyle.setProperty('--font', 'clamp(15px, 3.5vw, 17px)');
      } else if (kind === 'tablet'){
        rootStyle.setProperty('--gap', '12px');
        rootStyle.setProperty('--pad', '18px');
        rootStyle.setProperty('--font', 'clamp(15px, 2.1vw, 17px)');
      } else {
        rootStyle.setProperty('--gap', '14px');
        rootStyle.setProperty('--pad', '22px');
        rootStyle.setProperty('--font', 'clamp(15px, 1.15vw, 17px)');
      }
    }
    function fixMobileVH(){
      const vh = window.innerHeight * 0.01;
      rootStyle.setProperty('--vh', `${vh}px`);
    }
    tuneDensity(); fixMobileVH();
    window.addEventListener('resize', ()=>{ tuneDensity(); fixMobileVH(); });
  })();

  /* ===== Utilities ===== */
  const clamp=(n,min,max)=>Math.min(Math.max(n,min),max);
  const round5=n=>Math.round(n/5)*5;
  const fmt=n=>Math.round(n).toLocaleString('th-TH');

  /* ===== Food Builder ===== */
  function buildFoodTiles(target){
    const P = { chickenPer100:31, egg:6, milk:8, greek:17, whey:24, tofuPer100:12, beanPer100:8 };
    const items=[]; let remain=target;

    const chickenGram = target < 110 ? 120 : 200;
    const chick = Math.round(P.chickenPer100*chickenGram/100);
    items.push({icon:'üçó', title:`‡∏≠‡∏Å‡πÑ‡∏Å‡πà ${chickenGram} ‡∏Å‡∏£‡∏±‡∏°`, g:`‚âà ${chick} g`});
    remain -= chick;

    if(remain>0){
      const eggs = clamp(Math.round(remain/12),2,4);
      items.push({icon:'ü•ö', title:`‡πÑ‡∏Ç‡πà ${eggs} ‡∏ü‡∏≠‡∏á`, g:`‚âà ${eggs*P.egg} g`});
      remain -= eggs*P.egg;
    }
    if(remain>0){
      const dairy = Math.round(remain/16)||1;
      const useGreek = dairy>=2;
      const prot = dairy*(useGreek?P.greek:P.milk);
      items.push({icon:useGreek?'ü•£':'ü•õ', title:`${useGreek?'‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï‡∏Å‡∏£‡∏µ‡∏Å':'‡∏ô‡∏°'} ${dairy} ${useGreek?'‡∏ñ‡πâ‡∏ß‡∏¢':'‡πÅ‡∏Å‡πâ‡∏ß'}`, g:`‚âà ${prot} g`});
      remain -= prot;
    }
    if(remain>12){
      const g=150, prot=Math.round(P.tofuPer100*g/100);
      items.push({icon:'üßä', title:`‡πÄ‡∏ï‡πâ‡∏≤‡∏´‡∏π‡πâ‡πÅ‡∏Ç‡πá‡∏á ${g} ‡∏Å‡∏£‡∏±‡∏°`, g:`‚âà ${prot} g`}); remain-=prot;
    }
    if(remain>10){
      const g=150, prot=Math.round(P.beanPer100*g/100);
      items.push({icon:'ü´ò', title:`‡∏ñ‡∏±‡πà‡∏ß‡∏î‡∏≥‡∏ï‡πâ‡∏° ${g} ‡∏Å‡∏£‡∏±‡∏°`, g:`‚âà ${prot} g`}); remain-=prot;
    }
    if(remain>8){
      const scoops=Math.max(1,Math.round(remain/P.whey));
      items.push({icon:'ü•§', title:`‡πÄ‡∏ß‡∏¢‡πå ${scoops} ‡∏™‡∏Å‡∏π‡πä‡∏õ`, g:`‚âà ${scoops*P.whey} g`});
    }
    return items.slice(0,6);
  }

  /* ===== Fruit Builder (requested) ===== */
  function buildFruitTiles(){
    const FRUITS = [
      {icon:'üçå', title:'‡∏Å‡∏•‡πâ‡∏ß‡∏¢ (‡∏•‡∏π‡∏Å‡∏Å‡∏•‡∏≤‡∏á)', protein:1.3, note:'‡πÑ‡∏ü‡πÄ‡∏ö‡∏≠‡∏£‡πå/‡πÇ‡∏û‡πÅ‡∏ó‡∏™‡πÄ‡∏ã‡∏µ‡∏¢‡∏°'},
      {icon:'ü´ê', title:'‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà 1 ‡∏ñ‡πâ‡∏ß‡∏¢', protein:1.0, note:'‡∏™‡∏≤‡∏£‡∏ï‡πâ‡∏≤‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏π‡∏•‡∏≠‡∏¥‡∏™‡∏£‡∏∞'},
      {icon:'üçì', title:'‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà 1 ‡∏ñ‡πâ‡∏ß‡∏¢', protein:1.0, note:'‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡∏ã‡∏µ‡∏™‡∏π‡∏á'},
      {icon:'üçá', title:'‡∏≠‡∏á‡∏∏‡πà‡∏ô 1 ‡∏ñ‡πâ‡∏ß‡∏¢', protein:1.0, note:'‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ'},
      {icon:'üçä', title:'‡∏™‡πâ‡∏° (‡∏ú‡∏•‡∏Å‡∏•‡∏≤‡∏á)', protein:1.2, note:'‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡∏ã‡∏µ/‡∏ô‡πâ‡∏≥'},
      {icon:'ü•ë', title:'‡∏≠‡∏∞‡πÇ‡∏ß‡∏Ñ‡∏≤‡πÇ‡∏î (‡∏ú‡∏•‡∏Å‡∏•‡∏≤‡∏á)', protein:3.0, note:'‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏î‡∏µ/‡∏≠‡∏¥‡πà‡∏°‡∏ô‡∏≤‡∏ô'}
    ];
    return FRUITS.map(f=>({icon:f.icon, title:f.title, g:`‚âà ${f.protein} g ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô ¬∑ ${f.note}`}));
  }

  /* ===== Calculator ===== */
  function validateNumber(id, {min, max}, label){
    const el = document.getElementById(id);
    const val = parseFloat(el.value);
    const errEl = document.getElementById('err'+id.charAt(0).toUpperCase()+id.slice(1));
    errEl.textContent='';
    if(!Number.isFinite(val)){
      errEl.textContent = `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å${label}`; return null;
    }
    if(val<min || val>max){
      errEl.textContent = `${label}‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á ${min}‚Äì${max}`; return null;
    }
    return val;
  }

  function calc(){
    const weight = validateNumber('weight', {min:20, max:300}, '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å');
    const age = validateNumber('age', {min:10, max:100}, '‡∏≠‡∏≤‡∏¢‡∏∏');
    const mealsRaw = document.getElementById('meals').value;
    const meals = clamp(Math.round(parseFloat(mealsRaw) || 3),2,6);
    document.getElementById('errMeals').textContent = '';

    if(weight===null || age===null) return;

    const gender = document.getElementById('gender').value;
    const activity = document.getElementById('activity').value;
    const goal = document.getElementById('goal').value;

    let base = goal==='mild'?1.2: goal==='aggressive'?2.0:1.6;
    const adjAge = age>50?0.2:0;
    const adjGender = gender==='male'?0.1:0;    // ‡πÄ‡∏û‡∏®‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠
    const adjAct = activity==='light'?0.2: activity==='moderate'?0.4: activity==='high'?0.6:0;
    const FACTOR_CAP=2.4;
    const factor = Math.min(base+adjAge+adjGender+adjAct,FACTOR_CAP);

    const targetRaw = weight*factor;
    const target = round5(targetRaw);
    const perKg = target/weight;
    const perMeal = round5(target/meals);
    const rda = Math.round(weight*0.8); // 0.8 g/kg/d
    const lower = round5(Math.max(rda, targetRaw*0.9));
    const upper = round5(Math.min(targetRaw*1.1, weight*2.2)); // cap ~2.2 g/kg/d

    // render
    document.getElementById('bigTotal').textContent = `${fmt(target)} ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô`;
    document.getElementById('rangeChip').textContent = `‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${fmt(lower)}‚Äì${fmt(upper)} ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô`;
    document.getElementById('kgChip').textContent = `‚âà ${perKg.toFixed(2)} ‡∏Å‡∏£‡∏±‡∏°/‡∏Å‡∏Å.`;
    document.getElementById('mealsChip').innerHTML = `‚âà ${fmt(perMeal)} ‡∏Å‡∏£‡∏±‡∏°/‡∏°‡∏∑‡πâ‡∏≠ √ó <span id="mealsSpan">${meals}</span> ‡∏°‡∏∑‡πâ‡∏≠`;

    document.getElementById('dailyVal').textContent = `${fmt(target)} ‡∏Å‡∏£‡∏±‡∏°`;
    document.getElementById('perMealVal').textContent = `${fmt(perMeal)} ‡∏Å‡∏£‡∏±‡∏°`;
    document.getElementById('rdaVal').textContent = `${fmt(rda)} ‡∏Å‡∏£‡∏±‡∏°/‡∏ß‡∏±‡∏ô`;

    const span = Math.max(upper - rda, 1);
    const pct = clamp(((target - rda)/span)*100, 0, 100);
    document.getElementById('barFill').style.width = pct + '%';
    document.getElementById('barLeft').textContent = `‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (RDA) ${fmt(rda)} g`;
    document.getElementById('barRight').textContent = `‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ${fmt(upper)} g`;

    const foodGrid = document.getElementById('foodGrid'); foodGrid.innerHTML='';
    buildFoodTiles(target).forEach(it=>{
      const d = document.createElement('div');
      d.className='tile';
      d.innerHTML = `<div class="ico">${it.icon}</div><div><b>${it.title}</b><div class="muted">${it.g} ‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô</div></div>`;
      foodGrid.appendChild(d);
    });

    const fruitGrid = document.getElementById('fruitGrid'); fruitGrid.innerHTML='';
    buildFruitTiles().forEach(it=>{
      const d = document.createElement('div');
      d.className='tile';
      d.innerHTML = `<div class="ico">${it.icon}</div><div><b>${it.title}</b><div class="muted">${it.g}</div></div>`;
      fruitGrid.appendChild(d);
    });

    const result = document.getElementById('result');
    result.style.display = 'grid';
    result.setAttribute('tabindex','-1');
    result.focus({preventScroll:true});
    result.scrollIntoView({behavior:'smooth', block:'start'});

    // save last inputs
    const mem = {weight, age, gender, activity, goal, meals};
    localStorage.setItem('protein_calc_v1', JSON.stringify(mem));
  }

  // init events
  (function init(){
    const form = document.getElementById('form');
    form.addEventListener('submit', e=>{ e.preventDefault(); calc(); });

    // Clear
    document.getElementById('clear').addEventListener('click', ()=>{
      form.reset();
      document.getElementById('result').style.display='none';
      ['errWeight','errAge','errMeals'].forEach(id=>document.getElementById(id).textContent='');
      localStorage.removeItem('protein_calc_v1');
      document.getElementById('weight').focus();
    });

    // restore last
    try{
      const mem = JSON.parse(localStorage.getItem('protein_calc_v1')||'null');
      if(mem){
        document.getElementById('weight').value = mem.weight;
        document.getElementById('age').value = mem.age;
        document.getElementById('gender').value = mem.gender;
        document.getElementById('activity').value = mem.activity;
        document.getElementById('goal').value = mem.goal;
        document.getElementById('meals').value = mem.meals;
        calc();
      }
    }catch(e){ /* ignore */ }
  })();
</script>
</body>
</html>